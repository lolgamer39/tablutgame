<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tablut - The Viking Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <audio id="theme-music" loop>
        <source src="theme.mp3" type="audio/mp3">
    </audio>

    <div class="container" id="view-home">
        <img src="title.png" alt="Tablut Logo" class="logo">
        
        <div class="buttons-grid">
            <button class="btn btn-primary" onclick="showView('view-mode')">Gioca Ora</button>
            <button class="btn btn-secondary" onclick="showView('view-tutorial')">Come si gioca</button>
            
            <div class="row" style="justify-content: center; margin-top: 5px;">
                <button class="btn btn-icon" onclick="toggleSettings()">‚öôÔ∏è</button>
            </div>
        </div>
    </div>

    <div class="container hidden" id="view-mode">
        <h2>Scegli Modalit√†</h2>
        <p>Sfida un amico sullo stesso schermo o online.</p>
        
        <div class="buttons-grid">
            <button class="btn btn-secondary" onclick="window.location.href='game/game.html?mode=local'">
                üè† Partita Locale
            </button>
            
            <button class="btn btn-primary" onclick="showView('view-online-setup')">
                üåç Partita Online
            </button>
            
            <button class="btn btn-outline" onclick="showView('view-home')">Indietro</button>
        </div>
    </div>

    <div class="container hidden" id="view-online-setup">
        <h2>Configura Partita</h2>
        
        <div class="input-group">
            <label class="input-label">Il tuo Nome</label>
            <input type="text" id="username" placeholder="Es. Ragnar Lothbrok" maxlength="12">
        </div>

        <div class="input-group">
            <label class="input-label">Tempo di Gioco</label>
            <select id="time-control">
                <option value="10">10 Minuti (Rapida)</option>
                <option value="30">30 Minuti (Classica)</option>
                <option value="no-time">Senza Tempo</option>
            </select>
        </div>

        <div class="buttons-grid" style="margin-top: 10px;">
            <button class="btn btn-primary" onclick="startOnlineGame()">Cerca Avversario</button>
            <button class="btn btn-outline" onclick="showView('view-mode')">Annulla</button>
        </div>
    </div>

    <div class="container hidden" id="view-tutorial" style="max-width: 500px;">
        <h2>Guida Tattica</h2>
        <div class="tutorial-scroll-area">
            <div class="tutorial-step">
                <h3>‚öîÔ∏è Le Due Fazioni</h3>
                <p>I <strong>Bianchi</strong> (Re e guardie) partono dal centro. I <strong>Neri</strong> attaccano dai lati.</p>
            </div>
            <div class="tutorial-step">
                <h3>üéØ L'Obiettivo</h3>
                <p><strong>Bianchi:</strong> Portare il Re in un angolo.<br><strong>Neri:</strong> Catturare il Re circondandolo.</p>
            </div>
            <div class="tutorial-step">
                <h3>‚ôüÔ∏è Movimento</h3>
                <p>Le pedine si muovono in orizzontale e verticale (senza mischiare le due, o solo verticale, o solo orizzontale). Il Re segue la stessa logica, ma so pu√≤ muovere solo di una casella in orizzontale e verticale. Il Re √® l'unico che pu√≤ stare sul trono centrale.</p>
            </div>
            <div class="tutorial-step">
                <h3>üíÄ La Cattura</h3>
                <p>Chiudi un nemico tra due dei tuoi pezzi per mangiarlo. Il Re va circondato su 4 lati per essere catturato.</p>
                <p>La cattura del re decreta la vittoria del nero.</p>
            </div>
        </div>
        <button class="btn btn-outline" onclick="showView('view-home')">Torna al Menu</button>
    </div>

    <div id="settings-modal" class="settings-overlay hidden">
        <div class="settings-box">
            <h2>Impostazioni Audio</h2>
            <br>
            
            <div class="settings-row">
                <div class="settings-header">
                    <span>üéµ Musica Tema</span>
                    <label class="switch">
                        <input type="checkbox" id="music-toggle" checked onchange="updateAudioSettings()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <input type="range" id="music-vol" min="0" max="1" step="0.1" value="0.5" oninput="updateAudioSettings()">
            </div>

            <div class="settings-row">
                <div class="settings-header">
                    <span>üîä Effetti (Mosse/Vittoria)</span>
                    <label class="switch">
                        <input type="checkbox" id="sfx-toggle" checked onchange="updateAudioSettings()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <input type="range" id="sfx-vol" min="0" max="1" step="0.1" value="0.6" oninput="updateAudioSettings()">
            </div>

            <br>
            <button class="btn btn-outline" onclick="toggleSettings()">Chiudi</button>
        </div>
    </div>

    <script>
        const music = document.getElementById('theme-music');

        document.addEventListener('DOMContentLoaded', () => {
            // Carica preferenze
            const savedMusic = localStorage.getItem('tablut_music_on');
            const savedMusicVol = localStorage.getItem('tablut_music_vol');
            const savedSfx = localStorage.getItem('tablut_sfx_on');
            const savedSfxVol = localStorage.getItem('tablut_sfx_vol');

            if(savedMusic !== null) document.getElementById('music-toggle').checked = (savedMusic === 'true');
            if(savedMusicVol !== null) document.getElementById('music-vol').value = savedMusicVol;
            if(savedSfx !== null) document.getElementById('sfx-toggle').checked = (savedSfx === 'true');
            if(savedSfxVol !== null) document.getElementById('sfx-vol').value = savedSfxVol;

            updateAudioSettings();

            // Hack per Autoplay browser policy
            document.body.addEventListener('click', () => {
                if(document.getElementById('music-toggle').checked && music.paused) {
                    music.play().catch(e => console.log("Audio waiting for interaction"));
                }
            }, { once: true });
        });

        function updateAudioSettings() {
            const musicOn = document.getElementById('music-toggle').checked;
            const musicVol = document.getElementById('music-vol').value;
            const sfxOn = document.getElementById('sfx-toggle').checked;
            const sfxVol = document.getElementById('sfx-vol').value;

            music.volume = musicVol;
            if(musicOn) {
                if(music.paused) music.play().catch(()=>{});
            } else {
                music.pause();
            }

            localStorage.setItem('tablut_music_on', musicOn);
            localStorage.setItem('tablut_music_vol', musicVol);
            localStorage.setItem('tablut_sfx_on', sfxOn);
            localStorage.setItem('tablut_sfx_vol', sfxVol);
        }

        function showView(viewId) {
            document.querySelectorAll('.container').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('fade-in');
            });
            const target = document.getElementById(viewId);
            target.classList.remove('hidden');
            void target.offsetWidth; 
            target.classList.add('fade-in');
        }

        function toggleSettings() {
            document.getElementById('settings-modal').classList.toggle('hidden');
        }

        function startOnlineGame() {
            const name = document.getElementById('username').value.trim();
            const time = document.getElementById('time-control').value;
            if (!name) { alert("Inserisci un nome!"); return; }
            window.location.href = `game/game.html?mode=online&name=${encodeURIComponent(name)}&time=${time}`;
        }
    </script>
</body>
</html>
